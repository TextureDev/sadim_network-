<link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">



<style>
    /* --- لوحة إحصائيات الزوار - سديم --- */
    
    body {
        background-color: var(--color-bg);
        color: var(--color-deep);
        padding: 2rem;
    }

    .title {
        color: var(--color-light);
        text-align: center;
        margin-bottom: 2.5rem;
        font-size: 2.5rem;
        font-weight: 800;
        border-bottom: 2px solid var(--color-accent);
        display: inline-block;
        padding-bottom: 10px;
        width: 100%;
    }

    /* كروت الإحصائيات السريعة */
    .stats-container {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(223, 182, 178, 0.1);
        min-width: 250px;
        padding: 2rem;
        border-radius: var(--radius);
        text-align: center;
        backdrop-filter: blur(10px);
        transition: var(--transition);
    }

    .card:hover {
        transform: translateY(-5px);
        border-color: var(--color-accent);
    }

    .stats-label {
        color: var(--color-light);
        font-size: 1.1rem;
        opacity: 0.8;
        margin-bottom: 1rem;
    }

    .stats-number {
        color: var(--color-accent);
        font-size: 3rem;
        font-weight: 900;
        text-shadow: 0 0 15px rgba(133, 79, 108, 0.3);
    }

    /* أزرار التحكم */
    .admin-controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 0.8rem 1.5rem;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(223, 182, 178, 0.2);
    }

    .btn-delete {
        background: rgba(216, 92, 92, 0.1);
        color: #ff7675;
        border-color: #d85c5c;
    }

    .btn-delete:hover {
        background: #d85c5c;
        color: white;
    }

    .btn-nav {
        background: var(--color-primary);
        color: var(--color-light);
    }

    .btn-nav:hover {
        background: var(--color-accent);
        color: white;
    }

    /* الجدول السديمي */
    .table-wrapper {
        background: rgba(255, 255, 255, 0.02);
        border-radius: var(--radius);
        padding: 1rem;
        border: 1px solid rgba(223, 182, 178, 0.1);
        overflow-x: auto;
    }

    .styled-table {
        width: 100%;
        border-collapse: collapse;
        color: var(--color-deep);
    }

    .table-caption {
        font-size: 1.3rem;
        color: var(--color-light);
        margin-bottom: 1.5rem;
        text-align: right;
        padding-right: 10px;
    }

    .styled-table thead tr {
        background-color: rgba(43, 18, 76, 0.6);
        color: var(--color-light);
        text-align: right;
    }

    .styled-table th, .styled-table td {
        padding: 1.2rem;
        border-bottom: 1px solid rgba(223, 182, 178, 0.05);
    }

    .styled-table tbody tr:hover {
        background-color: rgba(133, 79, 108, 0.1);
    }

    /* تفاصيل البيانات */
    .ip-cell { font-family: 'Courier New', monospace; color: var(--color-accent); }
    .ua-cell { font-size: 0.85rem; opacity: 0.7; max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .page-cell { color: var(--tech-cyan); font-weight: 500; }
    .time-cell { font-size: 0.9rem; opacity: 0.8; }

</style>

<h2 class="title">إحصائيات الزوار الرقمية</h2>

<div class="stats-container">
    <div class="card">
        <p class="stats-label"><i class="fas fa-eye"></i> إجمالي عدد الزيارات</p>
        <p class="stats-number">{{ total_visits }}</p>
    </div>
</div>

<div class="admin-controls">
    <form action="{{ url_for('admin.delete_visits') }}" method="post" style="display:inline;">
        <button type="submit" class="btn-action btn-delete" onclick="return confirm('هل أنت متأكد من مسح كافة السجلات؟ لا يمكن التراجع!');">
            <i class="fas fa-trash-alt"></i> حذف السجل بالكامل
        </button>
    </form>
    
    <a href="{{ url_for('admin.admin_users_list') }}" class="btn-action btn-nav">
        <i class="fas fa-users"></i> إدارة المستخدمين
    </a>
    <a href="{{ url_for('admin.add_user') }}" class="btn-action btn-nav">
        <i class="fas fa-user-plus"></i> إضافة عضو
    </a>
    <a href="{{ url_for('admin.services_dashboard') }}" class="btn-action btn-nav">
        <i class="fas fa-arrow-right"></i> لوحة التحكم
    </a>
</div>

<div class="table-wrapper">
    <table class="styled-table">
        <caption class="table-caption">سجل التحركات الأخيرة</caption>
        <thead>
            <tr>
                <th>IP العنوان</th>
                <th>المتصفح والنظام (UA)</th>
                <th>الصفحة التي تمت زيارتها</th>
                <th>التوقيت</th>
            </tr>
        </thead>
        <tbody>
            {% for v in visits %}
            <tr>
                <td class="ip-cell">{{ v[0] }}</td>
                <td class="ua-cell" title="{{ v[1] }}">{{ v[1] }}</td>
                <td class="page-cell">{{ v[2] }}</td>
                <td class="time-cell">{{ v[3] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>